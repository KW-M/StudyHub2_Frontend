<section class="post-card-scroll-zone">
  <section class="post-card-header mat-elevation-z3">
    <img src="https://material-components-web.appspot.com/images/16-9.jpg" style="width:100%;height:100%">
    <img [src]="currentLinkPreview?.thumbnail" *ngIf="currentLinkPreview.thumbnail" class="post-header-preview-image">
    <!-- <div class="post-header-ripple" matRipple></div> -->
    <div class="post-header-overlay top-overlay">
      <button mat-icon-button style="margin: -4px 4px 0 auto;right:0;top:0" (click)="closeModal()">
        <mat-icon>close</mat-icon>
      </button>
    </div>
    <div class="post-header-middle" *ngIf="linkURL != currentPost.link || linkURL == ''">
      <button mat-fab color="light">
        <mat-icon>link</mat-icon>
      </button>
      <button mat-fab color="light">
        <mat-icon>cloud_upload</mat-icon>
      </button>
      <button mat-fab color="light">
        <img style="width:22px; height:22px;" src="http://studyhub.york.org/images/drive_icon.svg">
      </button>
    </div>
    <div class="link-input" *ngIf="linkURL != currentPost.link || linkURL == ''">
      <mat-form-field floatPlaceholder="never">
        <input matInput placeholder="http://" type="url" [(ngModel)]="linkURL" (input)="onLinkInput(linkURL)" appScrollToElement="end">
      </mat-form-field>
      <mat-progress-bar class="example-margin" color="primary" mode="indeterminate" *ngIf="linkURL != '' && linkURL != currentPost.link && currentPost.attachmentName == null">
      </mat-progress-bar>
    </div>
    <div class="post-header-overlay bottom-overlay" *ngIf="linkURL == currentPost.link && currentPost.attachmentName != null">
      <span style="display:none;margin: 0 auto 0 12px;">Title Is Here</span>
      <div class="link-chip">
        <img [src]="currentLinkPreview.icon || 'https://drive-thirdparty.googleusercontent.com/16/type/application/pdf'" class="link-favicon">
        <span class="link-name">{{currentPost.attachmentName}}</span>
        <mat-icon class="link-chip-remove" (click)="onLinkInput('')">cancel</mat-icon>
      </div>
    </div>
  </section>
  <section class="post-card-labels-container" [ngClass]="{'expanded':labelAreaExpanded,'class-chooser-expanded':classChooserExpanded}">
    <div class="expand-button-container mat-elevation-z2">
      <button mat-icon-button class="expand-button" (click)="labelAreaExpanded = !labelAreaExpanded;classChooserExpanded = false">
        <mat-icon>keyboard_arrow_down</mat-icon>
      </button>
    </div>
    <div class="class-selector-backdrop" (click)="classChooserExpanded = false"></div>
    <div class="class-selector-area">
      <mat-selection-list #shoes1 style="padding-top:0;" [(ngModel)]="currentPost.classes" *ngIf="labelAndClassSearchText == ''">
        <mat-list-option [value]="class" *ngFor="let class of userFavorites" (keydown)="$event.stopPropagation()">
          <h4 mat-line>{{class}}</h4>
        </mat-list-option>
      </mat-selection-list>
      <mat-selection-list #shoes style="padding-top:0;" [(ngModel)]="currentPost.classes" (keydown)="$event.stopPropagation()">
        <ng-container *ngFor="let class of filteredClasses; let classIndex = index">
          <div class="class-catagory-header" *ngIf="(class?.category != filteredClasses[classIndex - 1]?.category)">
            <h3 mat-subheader [ngStyle]="{'background': 'linear-gradient(152deg,hsl('+class?.color.h+','+class?.color.s+'%,'+class?.color.l+'%), white)'}"
              style="margin-top: 0;">{{class.category}}</h3>
          </div>
          <mat-list-option [value]="class.name">
            <h4 mat-line [ngStyle]="{'color': 'hsl('+class?.color.h+','+class?.color.s+'%,40%)'}">{{class.name}}</h4>
          </mat-list-option>
        </ng-container>
      </mat-selection-list>
    </div>
    <div class="class-label-search-area">
      <mat-icon>search</mat-icon>
      <input placeholder="Search Classes and Groups" appScrollToElement="end" (input)="onLabelAndClassSearchInput($event.target.value)"
        [(ngModel)]="labelAndClassSearchText">
      <button mat-button color="accent" class="dense-button" (click)="labelAreaExpanded = false;classChooserExpanded = false;onLabelAndClassSearchInput('')">Done</button>
    </div>
    <div class="label-selector-area">
      <mat-chip-list [multiple]="true" [(ngModel)]="currentPost.labels">
        <mat-basic-chip [selectable]="false" class="class-expand-button" (keydown)="$event.stopPropagation()">
          <button mat-button color="primary" *ngIf="!classChooserExpanded" (click)="labelAreaExpanded = true;classChooserExpanded = true">
            <span>{{currentPost.classes.join(', ') || 'CLASS'}}</span>
            <mat-icon *ngIf="currentPost.classes.length === 0" style="padding-bottom: 4px">arrow_drop_down</mat-icon>
            <mat-icon *ngIf="currentPost.classes.length !== 0" style="padding: 6px 0 6px 6px;font-size: 18px;height: 18px;width: 18px;color:black;opacity:0.6"
              (click)="currentPost.classes = []">cancel</mat-icon>
          </button>
        </mat-basic-chip>
        <span class="formatting-divider" style="order:-1;flex:none"></span>
        <mat-chip color="primary" #labelChip="matChip" (click)="toggleChipSelect(chipIndex,false);" [value]="label.name" *ngFor="let label of filteredLabels; let chipIndex = index;">{{label.name}}
          <mat-icon *ngIf="labelChipList[chipIndex]?.selected" class="mat-chip-remove">cancel</mat-icon>
        </mat-chip>
        <mat-basic-chip [selectable]="false" *ngIf="filteredLabels.length === currentPost.labels.length">
          <button mat-button (click)="createLabel(labelAndClassSearchText)">
            Create Label:
            <mat-chip color="primary" style="pointer-events: none">{{labelAndClassSearchText}}</mat-chip>
          </button>
        </mat-basic-chip>
      </mat-chip-list>
    </div>
  </section>
  <input class="post-card-title" Placeholder="Title" appScrollToElement="center" [(ngModel)]="currentPost.title">
  <p class="post-card-body-text" #descriptionHTML contenteditable="true" appScrollToElement="center" [innerHTML]="currentPost.description"></p>
  {{currentPost.labels}}
</section>
<section class="post-card-actions">
  <button mat-raised-button color="accent" raised="true" (click)="submitPost()" style="margin-right: 6px">SAVE</button>
  <button mat-button class="dense-button formatting-button" color="light">
    <mat-icon>format_bold</mat-icon>
  </button>
  <button mat-button class="dense-button formatting-button" color="light">
    <mat-icon>format_italic</mat-icon>
  </button>
  <button mat-button class="dense-button formatting-button" color="light">
    <mat-icon>format_underline</mat-icon>
  </button>
  <span class="formatting-divider"></span>
  <button mat-button class="dense-button formatting-button" color="light">
    <mat-icon>format_size</mat-icon>
  </button>
  <button mat-button class="dense-button formatting-button" color="light">
    <mat-icon>format_color_text</mat-icon>
  </button>
  <span class="formatting-divider"></span>
  <button mat-icon-button>
    <mat-icon>keyboard_arrow_up</mat-icon>
  </button>
  <span style="flex:1"></span>
  <button mat-icon-button (click)="closeModal()">
    <mat-icon>delete</mat-icon>
  </button>
</section>